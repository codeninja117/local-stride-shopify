<div class="article-gallery">
  <div class="gallery-main swiper" data-js="gallery-main-{{ block.id }}">
    <div class="swiper-wrapper">
      {%- if block.settings.main_image != blank -%}
        <div class="swiper-slide">
          <img 
            src="{{ block.settings.main_image | image_url: width: 800, height: 600 }}" 
            alt="{{ block.settings.main_image.alt | default: 'Product gallery main image' }}"
            class="gallery-main__image"
            loading="lazy"
            width="800"
            height="600"
          />
        </div>
      {%- endif -%}
      
      {%- for i in (1..8) -%}
        {%- assign image_key = 'gallery_image_' | append: i -%}
        {%- assign video_key = 'gallery_video_' | append: i -%}
        {%- assign current_image = block.settings[image_key] -%}
        {%- assign current_video = block.settings[video_key] -%}
        
        {%- if current_image != blank -%}
          <div class="swiper-slide">
            <img 
              src="{{ current_image | image_url: width: 800, height: 600 }}" 
              alt="{{ current_image.alt | default: 'Product gallery image' }}"
              class="gallery-main__image"
              loading="lazy"
              width="800"
              height="600"
            />
          </div>
        {%- elsif current_video != blank -%}
          <div class="swiper-slide">
            {{
              current_video
              | media_tag:
                image_size: '800x600',
                autoplay: true,
                loop: true,
                preload: 'auto',
                class: 'gallery-main__video',
                playsinline: true,
                muted: true,
                controls: true
            }}
          </div>
        {%- endif -%}
      {%- endfor -%}
    </div>
    
    <div class="swiper-button-next"></div>
    <div class="swiper-button-prev"></div>
  </div>

  <div class="gallery-thumbnails swiper" data-js="gallery-thumbs-{{ block.id }}">
    <div class="swiper-wrapper">
      {%- if block.settings.main_image != blank -%}
        <div class="swiper-slide">
          <div class="gallery-thumb active">
            <img 
              src="{{ block.settings.main_image | image_url: width: 120, height: 120 }}" 
              alt="{{ block.settings.main_image.alt | default: 'Product thumbnail' }}"
              loading="lazy"
            />
          </div>
        </div>
      {%- endif -%}

      {%- for i in (1..8) -%}
        {%- assign image_key = 'gallery_image_' | append: i -%}
        {%- assign video_key = 'gallery_video_' | append: i -%}
        {%- assign current_image = block.settings[image_key] -%}
        {%- assign current_video = block.settings[video_key] -%}
        
        {%- if current_image != blank -%}
          <div class="swiper-slide">
            <div class="gallery-thumb">
              <img 
                src="{{ current_image | image_url: width: 120, height: 120 }}" 
                alt="{{ current_image.alt | default: 'Product thumbnail' }}"
                loading="lazy"
              />
            </div>
          </div>
        {%- elsif current_video != blank -%}
          <div class="swiper-slide">
            <div class="gallery-thumb gallery-thumb--video">
              <div class="gallery-thumb__video-preview">
                {{
                  current_video
                  | media_tag:
                    image_size: '120x120',
                    class: 'gallery-thumb__video-poster',
                    muted: true,
                    controls: false,
                    playsinline: true,
                    loop: true
                }}
                <div class="gallery-thumb__play-icon">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M8 5v14l11-7z"/>
                  </svg>
                </div>
              </div>
            </div>
          </div>
        {%- endif -%}
      {%- endfor -%}
    </div>
    
    <div class="swiper-button-next"></div>
    <div class="swiper-button-prev"></div>
  </div>
</div>

<style>
  
  .article-gallery {
    max-width: 800px;
    margin: 0 auto;
    --swiper-navigation-size: 16px;
  }

  .gallery-main {
    margin-bottom: 1rem;
  }

  .gallery-main__image,
  .gallery-main__video {
    width: 100%;
    height: auto;
    display: block;
  }

  .gallery-main__video {
    aspect-ratio: 4/3;
    object-fit: cover;
  }

  .gallery-thumb {
    border: 2px solid transparent;
    cursor: pointer;
    transition: border-color 0.2s ease;
    aspect-ratio: 1;
    overflow: hidden;
  }

  .gallery-thumb:hover {
    border-color: #ccc;
  }

  .gallery-thumb.active {
    border-color: #000;
  }

  .gallery-thumb img,
  .gallery-thumb__video-poster {
    width: 100%;
    height: 100%;
    object-fit: cover;
    display: block;
  }

  .gallery-thumb__video-preview {
    position: relative;
    width: 100%;
    height: 100%;
  }

  .gallery-thumb__play-icon {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: rgba(0, 0, 0, 0.7);
    color: white;
    border-radius: 50%;
    width: 32px;
    height: 32px;
    display: flex;
    align-items: center;
    justify-content: center;
    pointer-events: none;
  }

  @media (max-width: 768px) {
    .gallery-thumb__play-icon {
      width: 24px;
      height: 24px;
    }

    .gallery-thumb__play-icon svg {
      width: 12px;
      height: 12px;
    }
  }

  @media (max-width: 480px) {
    .gallery-thumb__play-icon {
      width: 20px;
      height: 20px;
    }

    .gallery-thumb__play-icon svg {
      width: 10px;
      height: 10px;
    }
  }
  .article-gallery .swiper-button-next,
  .swiper-button-prev {
    width: 40px;
    height: 30px;
    background-color: rgba(255, 255, 255, 0.6);
    transition: background-color 0.3s ease-in-out;
  }
  .article-gallery .swiper-button-next:hover,
  .swiper-button-prev:hover {
    background-color: rgba(255, 255, 255, 1);
  }
  .article-gallery .swiper-button-next {
    right: 0;
    border-radius: 12px 0 0 12px;
  }
  .article-gallery .swiper-button-prev {
    left: 0;
    border-radius: 0 12px 12px 0;
  }
  .article-gallery .swiper-slide.swiper-slide-thumb-active > *:first-child {
    border: 1px solid black;
  }

  .article-gallery .swiper-button-next.swiper-button-disabled,
  .swiper-button-prev.swiper-button-disabled {
    opacity: 0;
  }
</style>

<script>
  // Initialize Swiper galleries when Swiper is available
  function initGallerySwipers() {
    if (typeof Swiper !== 'undefined') {
      const galleryContainers = document.querySelectorAll('.article-gallery');
      
      galleryContainers.forEach(gallery => {
        const blockId = gallery.querySelector('[data-js^="gallery-main-"]').getAttribute('data-js').replace('gallery-main-', '');
        const mainContainer = gallery.querySelector('[data-js^="gallery-main-"]');
        const thumbsContainer = gallery.querySelector('[data-js^="gallery-thumbs-"]');
        
        if (!mainContainer || !thumbsContainer) return;
        
        // Initialize thumbnails swiper first
        const thumbsSwiper = new Swiper(thumbsContainer, {
          spaceBetween: 8,
          slidesPerView: 6,
          slidesPerGroup: 1,
          loop: true,
          freeMode: false,
          watchSlidesProgress: true,
          threshold: 10,
          navigation: {
            nextEl: thumbsContainer.querySelector('.swiper-button-next'),
            prevEl: thumbsContainer.querySelector('.swiper-button-prev'),
          },
          breakpoints: {
            480: {
              slidesPerView: 6,
              slidesPerGroup: 1,
              spaceBetween: 8,
            },
            768: {
              slidesPerView: 6,
              slidesPerGroup: 1,
              spaceBetween: 8,
            },
            1024: {
              slidesPerView: 6,
              slidesPerGroup: 1,
              spaceBetween: 8,
            }
          }
        });
        
        // Initialize main gallery swiper with thumbs
        const mainSwiper = new Swiper(mainContainer, {
          spaceBetween: 8,
          loop: true,
          autoHeight: true,
          navigation: {
            nextEl: mainContainer.querySelector('.swiper-button-next'),
            prevEl: mainContainer.querySelector('.swiper-button-prev'),
          },
          thumbs: {
            swiper: thumbsSwiper,
          },
        });
      });
    }
  }
  
  // Initialize when DOM is ready
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initGallerySwipers);
  } else {
    initGallerySwipers();
  }
  
  // Also initialize when Swiper loads
  window.addEventListener('swiperLoaded', initGallerySwipers);
</script>